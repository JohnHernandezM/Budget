=LET(
  g, G:G,
  r, ROW(),
  txt, INDEX(g, r),
  isEnd, LAMBDA(t, ISNUMBER(MATCH(RIGHT(t,2), {" L"," M"," H"}, 0))),
  start, AND(txt<>"", ISNUMBER(--LEFT(txt,4)), NOT(isEnd(txt))),
  last, LOOKUP(2, 1/(g<>""), ROW(g)),
  IF(start,
     LET(
       rng, INDEX(g, r):INDEX(g, last),
       flags, MAP(rng, LAMBDA(x, isEnd(x))),
       pos, XMATCH(TRUE, flags, 0),
       endrow, IFERROR(r+pos-1, last),
       TEXTJOIN(" ", TRUE, INDEX(g, r):INDEX(g, endrow))
     ),
     ""
  )
)
